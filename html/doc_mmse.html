<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<!-- 背景动画 以及初始化样式 -->
		<link rel="stylesheet" type="text/css" href="../css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="../css/demo.css">
		<link rel="stylesheet" type="text/css" href="../css/style.css">

		<script type="text/javascript" src="./config/urlConfig.js"></script>
		<!-- 导入vue.js -->
		<script type="text/javascript" src="../js/vue.js"></script>
		<!-- 引入jQuery.js -->
		<script src="../js/jquery/jquery.min.js"></script>
	</head>
	<body>
		<!-- 背景 -->
		<div class="satic-area">
			<div class="dynamic-area1"></div>
			<div class="dynamic-area2"></div>
		</div>
		<div id="content">

			<div class="scale" style="display: flex;flex-direction: column; justify-content: center;align-items: center;">
				
				<div id="title" style="text-align:left;font-size: 24px;color: #3185BB;width: 100%;padding-bottom: 5px;">
					<span>简易智能精神状态量表（MMSE）</span>
				</div>
				
				<div class="" style="display: flex;justify-content: center;align-items: center;font-size: 50px; width: 100%;height: 100%;border: solid 1px darkgray;border-radius: 5px;" v-if="data==null">
					用户答题中,请等待
				</div>
				<object  :data="testUrl" style="width: 100%;height: 100%;">
				
				</object>
				<div v-if="isFinish" style="display: flex;justify-content: center;align-items: center;width: 100%;height: 100%;border: 1px solid darkgray;border-radius: 5px;">
						<div class="" style="width: 350px;height: 130px;background-color: #3185BB;color: white;font-size: 60px;display: flex;justify-content: center;align-items: center;border-radius: 5px;">
							打印报告
						</div>
						<div class="" style="margin-left: 30px; width: 350px;height: 130px;background-color: #3185BB;color: white;font-size: 60px;display: flex;justify-content: center;align-items: center;border-radius: 5px;">
							下一个测验
						</div>
				</div>
			</div>
		</div>
	</body>
	<script src="utils/Storage.js"></script>
	<script src="../js/toJump.js"></script>
	<script>
		let USER_ID = null;
		try {
			USER_ID = window.location.search.split('?')[1].split(0, 1).join("");
		} catch (e) {
			//TODO handle the exception
			console.log('获取id出错')
		}
		let vue = new Vue({
			el: '#content',
			data: {
				data: null,
				websocket: null,
				url:'http://pcxjt.xnyy.psycloud-china.com/evaluation-mmes_lb1?call=1&testid=',
				isFinish:false,
				reData:null,
			},
			computed:{
				getUrl:function(){
					return this.url + this.data;
				},
				testUrl:function(){
					return this.url + 6;
				}
			},
			created() {
				let that = this;
				window.addEventListener("message", (e) => {
					that.reData = e.data;
					that.isFinish = true;
					console.log(e.data)
				})
				this.websocket = new WebSocket(config.wsURL + '/websocket/' + USER_ID);
				this.websocket.onmessage = function(e) {
					let data =JSON.parse(e.data) ;
					that.data = data.data;
					console.log(data)
				}
			},
			methods: {

			}
		})
		
		
	</script>
</html>
