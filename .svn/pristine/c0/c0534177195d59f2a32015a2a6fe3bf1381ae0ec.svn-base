<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>神经心理辅助诊疗系统</title>
		<script src="config/userConfig.js"></script>
		<!-- 背景动画 以及初始化样式-->
		<link rel="stylesheet" type="text/css" href="../css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="../css/demo.css">
		<link rel="stylesheet" href="../css/style.css">
		<link rel="stylesheet" type="text/css" href="../css/doc.css" />
		<!-- 导入vue.js -->
		<script src="../js/vue.js"></script>
		<script type="text/javascript" src="./config/urlConfig.js"></script>
		<!-- 引入jQuery.js -->
		<script src="../js/jquery/jquery.min.js"></script>
		<script src="../js/toJump.js"></script>
		
	</head>
	<style>
		.off{
			display: none;
		}
		label{
			white-space: nowrap;
		}
		select{
			width: 100%;
			height: 100%;
			border: none;
		}
		select:focus{
			outline: none;
		}
	</style>
	<body>

		<!-- 背景图 -->
		<div class="satic-area">
			<div class="dynamic-area1"></div>
			<div class="dynamic-area2"></div>
		</div>
		<div id="content" class="print-link no-print">
			<!-- 模块菜单 -->
			<div class="doc-pane" style="display: none;">
				<span>量表评估模块</span>

				<span>测验评估模块</span>

				<span>查询/打印报告</span>
			</div>
			<!-- 量表评估模块 -->
			<div class="scale" id="ind">
				<div class="scale-change scale-title">
					<img src="../svg/change.svg" />
					<p>切换自评模块</p>
				</div>
				<div class="scale-submit-box">
					<div class="scale-submit-content">
						<ul class="menue-icon-list" style="visibility: hidden;">
							<li class="menue-icon-item bgc-red"><img src="../svg/menue_icons/shutDown.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/home.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/edit.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/search.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/setting.svg"></li>
						</ul>
						<div class="scale-submit" onclick="issueTest()">
							发布测评
						</div>
						<ul class="menue-icon-list">
							<li class="menue-icon-item bgc-red" @click="quit()"><img src="../svg/menue_icons/shutDown.svg"></li>
							<li class="menue-icon-item bgc-blue" @click="home()"><img src="../svg/menue_icons/home.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/edit.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/search.svg"></li>
							<li class="menue-icon-item bgc-blue"><img src="../svg/menue_icons/setting.svg"></li>
						</ul>
					</div>

				</div>
				<div class="scale-left">
					<span class="scale-title"><img src="../svg/table.svg" />
						<p>选择测评量表</p>
					</span>

					<div class="scale-list">
						<input type="search" class="search" id="search" oninput="inputsearch()" onfocus="inputsearch()" />
						<!-- <div class="scale-list-box scrollbar"> -->
						<ul id="scale-add" style="padding: none;">
							<li v-for="(it,index) in scale_list.items" :key="it.aiScaleId" v-on:click="greet(it)">{{it.aiScaleName}}&nbsp;<img src="../svg/add.svg"
								 style=""></li>
						</ul>
						<!-- </div> -->
					</div>
				</div>
				<div class="scale-right">
					<span class="scale-title"><img src="../svg/user.svg" />
						<p>
							选择测评对象
						</p>
					</span>

					<div class="scale-right-select">
						<input type="search" id="searchUser" oninput="searchUser()" />

					</div>
					<span class="scale-title"><img src="../svg/msg.svg" />
						<p>基础信息</p>
					</span>

					<div class="scale-right-basMsg">
						<div class="off">
							<input type="" name="" id="userId" value="" />
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon fa-svg-icon svg-fa-user" width="24"
								 height="24" viewBox="0 0 448 512" style="fill: rgb(225, 43, 43);">
									<path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"></path>
								</svg>
								姓名：</label>
								<input type="" name="" id="userName" value="" maxlength="10"/>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon fa-svg-icon svg-fa-venus-mars" width="24"
								 height="24" viewBox="0 0 576 512" style="fill: rgb(49, 133, 187);">
									<path d="M564 0h-79c-10.7 0-16 12.9-8.5 20.5l16.9 16.9-48.7 48.7C422.5 72.1 396.2 64 368 64c-33.7 0-64.6 11.6-89.2 30.9 14 16.7 25 36 32.1 57.1 14.5-14.8 34.7-24 57.1-24 44.1 0 80 35.9 80 80s-35.9 80-80 80c-22.3 0-42.6-9.2-57.1-24-7.1 21.1-18 40.4-32.1 57.1 24.5 19.4 55.5 30.9 89.2 30.9 79.5 0 144-64.5 144-144 0-28.2-8.1-54.5-22.1-76.7l48.7-48.7 16.9 16.9c2.4 2.4 5.4 3.5 8.4 3.5 6.2 0 12.1-4.8 12.1-12V12c0-6.6-5.4-12-12-12zM144 64C64.5 64 0 128.5 0 208c0 68.5 47.9 125.9 112 140.4V400H76c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h36v36c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12v-36h36c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-36v-51.6c64.1-14.6 112-71.9 112-140.4 0-79.5-64.5-144-144-144zm0 224c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path>
								</svg>
								性别：</label><input class="off" type="" name="" id="userSex" value="" />
								<select name="" id="userSex_c">
									<option :style="{display:(msg.aiUserSex?'':'none')}" :value="msg.aiUserSex">{{msg.aiUserSex}}</option>
									<option value="男">男</option>
									<option value="女">女</option>
								</select>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" class="svg-icon an-icon ant-contacts" viewBox="64 64 896 896" width="24"
								 height="24" style="fill: rgb(225, 43, 43);">
									<path d="M594.3 601.5a111.8 111.8 0 0 0 29.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 0 0-74.6 126.1 8 8 0 0 0 8 8.4H407c4.2 0 7.6-3.3 7.9-7.5 3.8-50.6 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H661a8 8 0 0 0 8-8.4c-2.8-53.3-32-99.7-74.7-126.1zM512 578c-28.5 0-51.7-23.3-51.7-52s23.2-52 51.7-52 51.7 23.3 51.7 52-23.2 52-51.7 52zm416-354H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496z"></path>
								</svg>
								年龄：</label><input  type="text" name="" id="userAge" value=""  maxlength="3"/>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon fa-svg-icon svg-fa-graduation-cap"
								 width="24" height="24" viewBox="0 0 640 512" style="fill: rgb(49, 133, 187);">
									<path d="M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"></path>
								</svg>
								学历：</label><input class="off" type="" name="" id="userEdu" value="" />
								<select name="" id="userEdu_c">
									<option :class="[msg.aiUserEduBg?'':'off']" :value="msg.aiUserEduBg">{{msg.aiUserEduBg}}</option>
									<option value="小学">小学</option>
									<option value="初中">初中</option>
									<option value="高中/职中">高中/职中</option>
									<option value="大专">大专</option>
									<option value="本科">本科</option>
									<option value="硕士">硕士</option>
									<option value="博士">博士</option>
								</select>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon fa-svg-icon svg-fa-heart" width="24"
								 height="24" viewBox="0 0 512 512" style="fill: rgb(225, 43, 43);">
									<path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"></path>
								</svg>
								婚姻：</label><input class="off" type="" name="" id="userMarr" value="" />
								<select name="" id="userMarr_c">
									<option :class="[msg.aiUserMarriage?'':'off']" :value="msg.aiUserMarriage">{{msg.aiUserMarriage}}</option>
									<option value="已婚">已婚</option>
									<option value="未婚">未婚</option>
									<option value="离异">离异</option>
									<option value="保密">保密</option>
								</select>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon fa-svg-icon svg-fa-black-tie" width="24"
								 height="24" viewBox="0 0 448 512" style="fill: rgb(49, 133, 187);">
									<path d="M0 32v448h448V32H0zm316.5 325.2L224 445.9l-92.5-88.7 64.5-184-64.5-86.6h184.9L252 173.2l64.5 184z"></path>
								</svg>
								职业：</label><input class="off" type="" name="" id="userPro" value="" />
								<select name="" id="userPro_c">
									<option :class="[msg.aiUserProfession?'':'off']" :value="msg.aiUserProfession">{{msg.aiUserProfession}}</option>
									<option value="计算机">计算机</option>
									<option value="互联网">互联网</option>
									<option value="通讯">通讯</option>
									<option value="生产/工艺/制造">生产/工艺/制造</option>
									<option value="医护/护理/制药">医护/护理/制药</option>
									<option value="金融/银行/投资">金融/银行/投资</option>
									<option value="保险">保险</option>
									<option value="商业/服务行">商业/服务行</option>
									<option value="文化/广告/传媒">文化/广告/传媒</option>
									<option value="娱乐/艺术/表演">娱乐/艺术/表演</option>
									<option value="律师/法务">律师/法务</option>
									<option value="教育/培训">教育/培训</option>
									<option value="公务员/事业单位">公务员/事业单位</option>
									<option value="模特">模特</option>
									<option value="空姐">空姐</option>
									<option value="学生">学生</option>
									<option value="其它">其它</option>
								</select>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon svg-md-account_balance" width="24"
								 height="24" viewBox="0 0 24 24" style="fill: rgb(225, 43, 43);">
									<path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zm-4.5-9L2 6v2h19V6l-9.5-5z"></path>
								</svg>
								科室：</label><input type="" name="" id="userOffice" value=""  maxlength="15"/>
						</div>
						<div class="scale-right-basMsg-div">
							<label>
								<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="svg-icon fa-svg-icon svg-fa-road" width="24"
								 height="24" viewBox="0 0 576 512" style="fill: rgb(49, 133, 187);">
									<path d="M573.19 402.67l-139.79-320C428.43 71.29 417.6 64 405.68 64h-97.59l2.45 23.16c.5 4.72-3.21 8.84-7.96 8.84h-29.16c-4.75 0-8.46-4.12-7.96-8.84L267.91 64h-97.59c-11.93 0-22.76 7.29-27.73 18.67L2.8 402.67C-6.45 423.86 8.31 448 30.54 448h196.84l10.31-97.68c.86-8.14 7.72-14.32 15.91-14.32h68.8c8.19 0 15.05 6.18 15.91 14.32L348.62 448h196.84c22.23 0 36.99-24.14 27.73-45.33zM260.4 135.16a8 8 0 0 1 7.96-7.16h39.29c4.09 0 7.53 3.09 7.96 7.16l4.6 43.58c.75 7.09-4.81 13.26-11.93 13.26h-40.54c-7.13 0-12.68-6.17-11.93-13.26l4.59-43.58zM315.64 304h-55.29c-9.5 0-16.91-8.23-15.91-17.68l5.07-48c.86-8.14 7.72-14.32 15.91-14.32h45.15c8.19 0 15.05 6.18 15.91 14.32l5.07 48c1 9.45-6.41 17.68-15.91 17.68z"></path>
								</svg>
								来源：
							</label>	
								<input  class="off" type="" name="" id="userFrom" value="" />
								<select name="" id="userFrom_c">
									<option :class="[msg.aiUserFrom?'':'off']" :value="msg.aiUserFrom">{{msg.aiUserFrom}}</option>
									<option value="门诊">门诊</option>
									<option value="住院">住院</option>
									<option value="其它">其它</option>
								</select>
						</div>
					</div>
					<span class="scale-title"><img src="../svg/re.svg" />
						<p> 选择量表</p>
					</span>

					<div class="scale-result">
						<ul id="scale-result-list">
							<li v-for="it in scale_result_list.items" :key="it.aiScaleId" v-on:click="greet1(it)">{{it.aiScaleName}}&nbsp;<img src="../svg/delete.svg" /></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

	</body>
	<script src="utils/Storage.js"></script>
	<script>
		//let USER_ID = window.location.search.split('?')[1].split(0, 1).join("");
		console.log(USER_ID);
		let isUser = false; //定义该账户是否存在于数据库中,true表示存在，false表示不存在
		let userData = null; //存放从数据库获取到的用户原始信息
		$(document).ready(function() {
			$.ajax({
				type: 'GET',
				url: config.url + '/scales/all',
				success: function(data) {
					//alert(data.object)
					console.log(data.object)
					scale.items = data.object.slice(0, data.object.length);
					scale_list.items = data.object.slice(0, data.object.length);
					scale_rest.items = data.object.slice(0, data.object.length);
				},
				error: function(data) {
					console.log('连接失败')
				}
			})
		});

		//量表合集
		var scale = {
			items: []
		};
		//被选中的量表
		var scale_result_list = {
			items: []
		};
		//搜索出来的量表
		var scale_search_list = {
			items: []
		};
		//显示的量表
		var scale_list = {
			items: []
		};
		//未被选中的量表
		var scale_rest = {
			items: []
		};

		/**
		 * 选择结果量表
		 */
		// new Vue({
		// 	el: '#scale-result-list',
		// 	data: scale_result_list,
		// 	methods: {
				
		// 	}
		// });


		/**
		 * 所有显示的量表
		 */
		let vue = new Vue({
			el: '#content',
			data: {
				scale_list,
				scale_result_list,
				msg:{
					aiUserId:'',
					aiUserName:'',
					aiUserSex:'',
					aiUserAge:'',
					aiUserEduBg:'',
					aiUserMarriage:'',
					aiUserProfession:'',
					aiUserOffice:'',
					aiUserFrom:''
				}
			},
			methods: {
				home() {
					location.href = 'menue.html'
				},
				quit() {
					sstorage.removeItem('logins')
					location.reload()
				},
				greet1: function(it) {
					console.log(it)
					let o = {};
					o.aiScaleName = it.aiScaleName;
					o.aiScaleId = it.aiScaleId;
					o.aiScaleOverview = it.aiScaleOverview;
					scale_rest.items.push(o);
					scale_list.items.push(o);
					for (let i = 0; i < scale_result_list.items.length; i++) {
						if (it.aiScaleId == scale_result_list.items[i].aiScaleId) {
							scale_result_list.items.splice(i, 1)
							break
						}
					}
				},
				greet: function(it) {
					let o = {};
					o.aiScaleName = it.aiScaleName;
					o.aiScaleId = it.aiScaleId;
					o.aiScaleOverview = it.aiScaleOverview;
					o.aiScaleNotice = it.aiScaleNotice;
					scale_result_list.items.push(o);
					for (let i = 0; i < scale_rest.items.length; i++) {
						if (it.aiScaleId == scale_rest.items[i].aiScaleId) {
							scale_rest.items.splice(i, 1);
							break;
						}
					}
					for (let i = 0; i < scale_list.items.length; i++) {
						if (it.aiScaleId == scale_list.items[i].aiScaleId) {
							scale_list.items.splice(i, 1);
							break;
						}
					}

				}
			}
		});
		/**
		 * 搜索结果量表
		 */
		function inputsearch() {
			let a = $('#search').val().replace(/\s*/g, "");
			if (a == "") {
				scale_list.items = scale_rest.items.slice(0, scale_rest.items.length);
				return
			}
			let kw = new RegExp(a, 'i');
			let arr = []
			for (let i = 0; i < scale_rest.items.length; i++) {
				if (kw.test(scale_rest.items[i].aiScaleName)) {
					arr.push(scale_rest.items[i]);
				}
			}
			scale_list.items = arr;
		}
		/**
		 * 搜索用户
		 */
		function searchUser() {

			let a = $('#searchUser').val().replace(/\s*/g, "");
			if (a == "") {
				$('#userId').val("");
				$('#userName').val("");
				$('#userAge').val("");
				$('#userOffice').val("");
				$('#userSex').val("");
				$('#userPro').val("");
				$('#userFrom').val("");
				$('#userEdu').val("");
				$('#userMarr').val("");
				for(let i in vue.msg){
					vue.msg[i] = ' '
				}
				return
			} else {
				$.ajax({
					type: 'GET',
					url: config.url + '/users/msgForDoc/' + a,
					success: function(e) {
						console.log(e)
						var data = e.object;
						if (data) {
							userData = data;
							isUser = true;
							$('#userId').val(data.aiUserId);
							$('#userName').val(data.aiUserName);
							$('#userAge').val(data.aiUserAge);
							$('#userOffice').val(data.aiUserOffice);
							$('#userSex').val(data.aiUserSex);
							$('#userPro').val(data.aiUserProfession);
							$('#userFrom').val(data.aiUserFrom);
							$('#userEdu').val(data.aiUserEduBg);
							$('#userMarr').val(data.aiUserMarriage);
							for(i in data){
								vue.msg[i] = data[i];
							}
							//将用户信息存入session中
							console.log(data)
							sstorage.setItem("userMsg", data);
						} else {
							isUser = false;
							userData = null;
							$('#userId').val("");
							$('#userName').val("");
							$('#userAge').val("");
							$('#userOffice').val("");
							$('#userSex').val("");
							$('#userPro').val("");
							$('#userFrom').val("");
							$('#userEdu').val("");
							$('#userMarr').val("");
							for(let i in vue.msg)
							vue.msg[i] = ''
						}
					},
					error: function(e) {
						console.log('连接出错')
					}
				})
			}
		}
		/**
		 * 发布测评
		 */
		function issueTest() {
			let a = $('#searchUser').val().replace(/\s*/g, "");
			if (scale_result_list.items.length == 0) {
				alert("没有选中的测评哦");
			} else if (a == "") {
				alert("请选择测评对象");
			} else if (
				a == "" ||
				$('#userName').val().replace(/\s*/g, "") == "" ||
				$('#userAge').val().replace(/\s*/g, "") == "" ||
				$('#userOffice').val().replace(/\s*/g, "") == "" ||
				$('#userSex').val().replace(/\s*/g, "") == "" ||
				$('#userPro').val().replace(/\s*/g, "") == "" ||
				$('#userFrom').val().replace(/\s*/g, "") == "" ||
				$('#userEdu').val().replace(/\s*/g, "") == "" ||
				$('#userMarr').val().replace(/\s*/g, "") == ""
			) {
				alert("请填写完基础信息");
			} else {
				$.ajax({
					url: config.url + '/report/redis0/' + USER_ID,
					async: false,
					type: 'DELETE',
					success: function(e) {
						console.log(e)
					}
				})
				//本地存放所有未做的量表，初始为所有量表(发布测评中的量表)
				let date = new Date().toLocaleString('chinese', {
					hour12: false
				});
				date = date.replace(/\//g, '-');
				sstorage.setItem('date', date);
				sstorage.setItem("scale", scale_result_list);
				sstorage.setItem("scaleRest", scale_result_list)
				//保存选中的用户信息
				/**
				 * 需要与之前的信息进行比较，如有变为修改数据库 
				 */
				let o = {};
				// o.aiUserId = $('#searchUser').val().replace(/\s*/g, "");
				// o.aiUserName = $('#userName').val();
				// o.aiUserAge = $('#userAge').val();
				// o.aiUserOffice = $('#userOffice').val();
				// o.aiUserSex = $('#userSex').val();
				// o.aiUserProfession = $('#userPro').val();
				// o.aiUserFrom = $('#userFrom').val();
				// o.aiUserEduBg = $('#userEdu').val();
				// o.aiUserMarriage = $('#userMarr').val();
				for(let i in vue.msg){
					o[i] = vue.msg[i]
				}
				o.aiUserProfession = $('#userPro_c').val();
				o.aiUserFrom =$('#userFrom_c').val();
				o.aiUserEduBg =$('#userEdu_c').val();
				o.aiUserMarriage =$('#userMarr_c').val();
				o.aiUserSex = $('#userSex_c').val();
				//将用户信息存入session中
				let boo = false;
				if (isUser == true) {
					for (i in o) {
						if (userData[i] != o[i]) {
							boo = true;
							break;
						}
						console.log('???')
					}
				} else {
					boo = true;
				}
				console.log(o, '***')
				
				if (boo) {
					let ind = 0;
					if (isUser)
						ind = 1;
					console.log('提交')
					$.ajax({
						type: 'POST',
						async: false,
						url: config.url + '/users/userW/' + JSON.stringify(o) + '/' + ind,
						data:{
							valeu:JSON.stringify(o)
						},
						success: function(e) {
							console.log(e)

							sstorage.setItem("userMsg", o);
							//将测评量表发送至用户
							var obj = {
								target: $('#userId').val(),
								from_who: USER_ID,
								data: scale_result_list.items,
								isCache: true, //将信息发送至服务器缓存
								status: 5,
								dataType: "scale",
								dataName: '量表信息'
							};
							//量表信息发送给用户
							sendMSG(obj);
							console.log(scale_result_list.items[0].aiScaleId)

							//按选择量表顺序第一个跳转跳转页面
							toJump(scale_result_list.items[0].aiScaleId);

						}
					})
				} else {
					console.log(o)
					sstorage.setItem("userMsg", o);
					//将测评量表发送至用户
					var obj = {
						target: $('#userId').val(),
						from_who: USER_ID,
						data: scale_result_list.items,
						isCache: true, //将信息发送至服务器缓存
						status: 5,
						dataType: "scale",
						dataName: '量表信息'
					};
					//量表信息发送给用户
					sendMSG(obj);
					console.log(scale_result_list.items[0].aiScaleId)

					//按选择量表顺序第一个跳转跳转页面
					toJump(scale_result_list.items[0].aiScaleId);

				}


				//window.location.href  = "iframe/scales.html?"+USER_ID;
				//需要根据scale_result_list转到相应的页面
				//window.location.href = "doc_ligature.html?"+USER_ID;

			}
		}

		var ws = new WebSocket(config.wsURL + '/websocket/' + USER_ID);
		ws.onopen = function(e) {
			console.log('连接成功');
		}

		ws.onmessage = function(e) {
			console.log('有消息推送');
		}
		ws.onerror = function(e) {
			console.log('连接出错');
		}
		ws.onclose = function(e) {
			console.log('连接关闭');
		}

		function sendMSG(msg) {
			ws.send(JSON.stringify(msg));
		}
		window.onbeforeunload = function() {
			ws.close();
		}
	</script>
</html>
